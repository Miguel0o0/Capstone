{% extends "base.html" %}
{% load static %}

{% block title %}Inicio – Junta UT{% endblock %}

{# CSS de Leaflet solo para esta página #}
{% block extra_head %}
  {{ block.super }}
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
{% endblock %}

{% block content %}
<div class="home-welcome">
  <h1 class="home-welcome-title">Bienvenido a la Junta de Vecinos UT Nro 2</h1>
  <p class="home-welcome-subtitle">Vecinos de la comunidad</p>

  {# Introducción general #}
  <section class="home-intro">
    <h2 class="home-intro-title">Tu espacio digital para gestionar todo con la Junta</h2>
    <p class="home-intro-text">
      Desde esta plataforma podrás mantenerte informado, realizar trámites y coordinar actividades
      con la comunidad sin tener que ir a la sede. 

      Aquí encontrarás los avisos oficiales
      de la Junta, podrás descargar documentos y certificados, reservar establecimientos,
      reportar incidencias en el barrio y mantener al día tus pagos de forma mucho más ordenada.
    </p>
  </section>

  {# Imagen principal #}
  <div class="home-welcome-image-wrapper">
    <img src="{% static 'img/foto junta de vecinos.png' %}"
         alt="Vecinos de la comunidad"
         class="home-welcome-image">
  </div>

  {# ==== MAPA SOLO PARA USUARIOS SIN SESIÓN ==== #}
  {% if not request.user.is_authenticated %}
    <section class="home-map-section">
      <div class="home-map-card">
        <h2>¿Estás dentro del área?</h2>
        
        <p class="home-map-text">
          Este mapa muestra el sector cubierto por la Junta de Vecinos UT. 
          Si tu domicilio está dentro del área, puedes registrarte como vecino 
          y usar los servicios de la plataforma.
        </p>

        <div id="junta-map"></div>

        <p class="home-map-caption">
          Centro de la Junta: <strong>Diego de Meza 5431, San Joaquín</strong>.
        </p>
      </div>
    </section>
  {% endif %}

  {# Diferente contenido según si está autenticado o no #}
  {% if request.user.is_authenticated %}

    {# ==== VISTA PARA VECINOS CON SESIÓN INICIADA ==== #}
    <div class="home-shortcuts">
      <article class="home-card">
        <h3 class="home-card-title">Certificados</h3>
        <p class="home-card-text">
          Descarga certificados, actas y comunicados importantes de la Junta.
        </p>
        <a href="{% url 'core:documents-list' %}" class="home-card-cta">
          Ver documentos →
        </a>
      </article>

      <article class="home-card">
        <h3 class="home-card-title">Avisos</h3>
        <p class="home-card-text">
          Entérate de las últimas novedades y anuncios para la comunidad.
        </p>
        <a href="{% url 'core:announcement_list' %}" class="home-card-cta">
          Ver avisos →
        </a>
      </article>

      <article class="home-card">
        <h3 class="home-card-title">Reservas</h3>
        <p class="home-card-text">
          Reserva canchas o el salón de eventos en pocos pasos.
        </p>
        <a href="{% url 'core:reservation_mine' %}" class="home-card-cta">
          Ir a reservas →
        </a>
      </article>
    </div>

    <section class="home-extra">
      <h2 class="home-intro-title">Mis pagos e incidencias en un solo lugar</h2>
      <p class="home-intro-text">
        En la sección <strong>Mis pagos</strong> podrás revisar de forma clara la deuda pendiente
        asociada a tus últimas reservas y a las cuotas que tengas con la Junta. Desde ahí verás
        qué pagos están al día, cuáles siguen pendientes y qué reservas han generado un cobro.
      </p>
      <p class="home-intro-text">
        Además, desde <strong>Incidencias</strong> podrás reportar problemas en tu barrio:
        luminarias en mal estado, problemas en áreas comunes, situaciones de seguridad y más,
        adjuntando fotos y una pequeña descripción para que la directiva pueda gestionarlas.
      </p>
    </section>

  {% else %}

    {# ==== VISTA PARA USUARIOS ANÓNIMOS (SIN CUENTA) ==== #}
    <section class="home-intro">
      <h2 class="home-intro-title">¿Qué podrás hacer con tu cuenta?</h2>
      <p class="home-intro-text">
        Al validar tu domicilio y crear una cuenta como vecino, tendrás acceso a un panel
        completo para gestionar tus tramites en línea.
      </p>

      <div class="home-intro-grid">
        <div>
          <h3 class="home-intro-item-title">Avisos y comunicados</h3>
          <p class="home-intro-item-text">
            Consultar los avisos oficiales, comunicados importantes y recordatorios de reuniones
            o actividades comunitarias. Todo quedará publicado en un solo lugar para que no te
            pierdas ninguna información relevante.
          </p>
        </div>

        <div>
          <h3 class="home-intro-item-title">Mis pagos</h3>
          <p class="home-intro-item-text">
            Revisar las cuotas de la Junta,
            subir comprobantes de transferencia y ver los pagos al día y cuáles siguen
            pendientes, de forma clara y ordenada.
          </p>
        </div>

        <div>
          <h3 class="home-intro-item-title">Incidencias en la comunidad</h3>
          <p class="home-intro-item-text">
            Reportar incidencias en tu sector: Problemas de iluminación, áreas comunes
            deterioradas o situaciones de seguridad. Ademas podras hacer seguimiento de tus reportes.
          </p>
        </div>

        <div>
          <h3 class="home-intro-item-title">Reservas de canchas y salón</h3>
          <p class="home-intro-item-text">
            Solicitar reservas de canchas deportivas o salón de eventos, revisar la
            disponibilidad y llevar el registro de tus reservas realizadas.
          </p>
        </div>

        <div>
          <h3 class="home-intro-item-title">Documentos y certificados</h3>
          <p class="home-intro-item-text">
            Descarga documentos emitidos por la Junta, como actas,
            certificados o reglamentos internos.
          </p>
        </div>
      </div>
    </section>

  {% endif %}
</div>
{% endblock %}

{# JS de Leaflet solo para anónimos, así evitamos ejecutar código si no hay mapa #}
{% block extra_body %}
  {{ block.super }}
  {% if not request.user.is_authenticated %}
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var center = [-33.506636, -70.635536]; // Diego de Meza 5431

        var map = L.map("junta-map").setView(center, 15);

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 19,
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        }).addTo(map);

        L.marker(center)
          .addTo(map)
          .bindPopup("Junta de Vecinos UT")
          .openPopup();

        L.circle(center, {
          radius: 900, // metros – ajusta el tamaño del área
          color: "#1d4ed8",
          fillColor: "#1d4ed8",
          fillOpacity: 0.15,
          weight: 2,
        }).addTo(map);
      });
    </script>
  {% endif %}
{% endblock %}
