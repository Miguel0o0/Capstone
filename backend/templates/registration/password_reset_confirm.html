{% extends "base.html" %}
{% load static %}

{% block title %}Nueva contrase√±a | Junta UT{% endblock %}

{% block content %}
<div class="auth-page">
  <div class="auth-card">
    <h1 class="auth-title">Define tu nueva contrase√±a</h1>

    {% if validlink %}
      <p class="auth-subtitle">
        Ingresa tu nueva contrase√±a. Te recomendamos que sea segura y f√°cil de recordar.
      </p>

      <form method="post" class="auth-form">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="form-group">
          <label for="{{ form.new_password1.id_for_label }}">Nueva contrase√±a</label>
          <div class="password-wrapper">
            {{ form.new_password1 }}
            <button type="button"
                    class="password-toggle"
                    aria-label="Mostrar u ocultar contrase√±a">
              üëÅ
            </button>
          </div>
          <ul class="helptext">
            <li>Debe tener al menos 8 caracteres.</li>
            <li>No debe ser demasiado similar a tus datos personales.</li>
            <li>No debe ser una contrase√±a muy com√∫n.</li>
            <li>No puede ser completamente num√©rica.</li>
          </ul>
          {% if form.new_password1.errors %}
            <div class="text-danger">
              {{ form.new_password1.errors|join:", " }}
            </div>
          {% endif %}
        </div>

        <div class="form-group">
          <label for="{{ form.new_password2.id_for_label }}">Confirma tu nueva contrase√±a</label>
          <div class="password-wrapper">
            {{ form.new_password2 }}
            <button type="button"
                    class="password-toggle"
                    aria-label="Mostrar u ocultar contrase√±a">
              üëÅ
            </button>
          </div>
          {% if form.new_password2.errors %}
            <div class="text-danger">
              {{ form.new_password2.errors|join:", " }}
            </div>
          {% endif %}
        </div>

        <button class="btn btn-primary auth-btn" type="submit">
          Guardar nueva contrase√±a
        </button>
      </form>
    {% else %}
      <p class="auth-subtitle">
        El enlace para restablecer la contrase√±a no es v√°lido o ya fue utilizado.
      </p>
      <div class="auth-links">
        <a href="{% url 'password_reset' %}">Solicitar un nuevo enlace</a>
      </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".password-wrapper").forEach(function (wrapper) {
      const input = wrapper.querySelector("input");
      const btn = wrapper.querySelector(".password-toggle");
      if (!input || !btn) return;

      btn.addEventListener("click", function () {
        const isPassword = input.type === "password";
        input.type = isPassword ? "text" : "password";
        btn.textContent = isPassword ? "üôà" : "üëÅ";
      });
    });
  });
</script>
{% endblock %}
