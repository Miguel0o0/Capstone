{% extends "base.html" %}

{% block title %}Validación de domicilio – Boleta de servicio{% endblock %}

{% block content %}
<div class="auth-page">
  <div class="auth-card auth-card--wide">
    <h1 class="auth-title">Validación de domicilio – Boleta de servicio</h1>

    <p style="color:#000000; font-size:.9rem; margin-bottom:1.2rem; text-align:left;">
      Ingresa los datos que solicitamos por favor, junto con una boleta (agua, luz o gas).
      Usaremos estos datos para revisar tu solicitud y avisarte si tu inscripción fue aprobada
      o rechazada.
    </p>

    <form method="post" enctype="multipart/form-data" class="auth-form" id="insc-create-form">
      {% csrf_token %}

      <!-- Nombre -->
      <div class="form-group">
        <label for="{{ form.first_name.id_for_label }}">Nombre</label>
        {{ form.first_name }}
        {% if form.first_name.help_text %}
          <p class="text-muted" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.first_name.help_text }}
          </p>
        {% endif %}
        {% if form.first_name.errors %}
          <div class="text-danger" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.first_name.errors }}
          </div>
        {% endif %}
      </div>

      <!-- Apellido -->
      <div class="form-group">
        <label for="{{ form.last_name.id_for_label }}">Apellido</label>
        {{ form.last_name }}
        {% if form.last_name.help_text %}
          <p class="text-muted" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.last_name.help_text }}
          </p>
        {% endif %}
        {% if form.last_name.errors %}
          <div class="text-danger" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.last_name.errors }}
          </div>
        {% endif %}
      </div>

      <!-- RUT -->
      <div class="form-group">
        <label for="{{ form.rut.id_for_label }}">RUT</label>
        {{ form.rut }}
        {% if form.rut.help_text %}
          <p class="text-muted" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.rut.help_text }}
          </p>
        {% endif %}
        {% if form.rut.errors %}
          <div class="text-danger" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.rut.errors }}
          </div>
        {% endif %}
      </div>

      <!-- Dirección -->
      <div class="form-group">
        <label for="{{ form.address.id_for_label }}">Dirección</label>
        {{ form.address }}
        {% if form.address.help_text %}
          <p class="text-muted" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.address.help_text }}
          </p>
        {% endif %}
        {% if form.address.errors %}
          <div class="text-danger" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.address.errors }}
          </div>
        {% endif %}
      </div>

      <!-- Correo electrónico -->
      <div class="form-group">
        <label for="{{ form.email.id_for_label }}">Correo electrónico</label>
        {{ form.email }}
        {% if form.email.help_text %}
          <p class="text-muted" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.email.help_text }}
          </p>
        {% endif %}
        {% if form.email.errors %}
          <div class="text-danger" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.email.errors }}
          </div>
        {% endif %}
      </div>

      <!-- Boleta de servicio -->
      <div class="form-group">
        <label for="{{ form.file.id_for_label }}">Boleta de servicio</label>
        {{ form.file }}
        {% if form.file.help_text %}
          <p class="text-muted" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.file.help_text }}
          </p>
        {% endif %}
        {% if form.file.errors %}
          <div class="text-danger" style="font-size:.8rem; margin-top:.25rem;">
            {{ form.file.errors }}
          </div>
        {% endif %}
      </div>

      <div style="display:flex; gap:.5rem; margin-top:.75rem;">
        <button type="submit" class="btn btn-primary auth-btn">
          Enviar solicitud
        </button>
        <a href="{% url 'core:home' %}" class="btn btn-outline">
          Cancelar
        </a>
      </div>
    </form>
  </div>
</div>

{# Toast superior para confirmar envío de inscripción #}
<div id="insc-toast" class="insc-toast"></div>

<style>
  .insc-toast {
    position: fixed;
    left: 50%;
    top: 18px;
    transform: translateX(-50%) translateY(-20px);
    background: #2210beff;
    color: #f9fafb;
    padding: 0.6rem 1.4rem;
    border-radius: 999px;
    font-size: 0.85rem;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.35);
    opacity: 0;
    pointer-events: none;
    z-index: 1300;
    transition: opacity 0.18s ease, transform 0.18s ease;
  }

  .insc-toast.is-visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
</style>

<script>
  (function () {
    const form  = document.getElementById("insc-create-form");
    const toast = document.getElementById("insc-toast");

    if (!form || !toast) return;

    function showToast(message, callback) {
      toast.textContent = message;
      toast.classList.add("is-visible");

      setTimeout(function () {
        toast.classList.remove("is-visible");
        if (typeof callback === "function") {
          callback();
        }
      }, 1100);
    }

    function handleSubmit(e) {
      // Validación HTML5: si falta algo requerido, no mostramos el toast
      if (typeof form.reportValidity === "function" && !form.reportValidity()) {
        return;
      }

      e.preventDefault();

      showToast(
        "Tu solicitud fue enviada. La Junta revisará tu documento para validar tu domicilio.",
        function () {
          form.removeEventListener("submit", handleSubmit);
          form.submit();
        }
      );
    }

    form.addEventListener("submit", handleSubmit);
  })();
</script>
{% endblock %}
