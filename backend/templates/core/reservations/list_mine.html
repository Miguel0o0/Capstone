{% extends "base.html" %}
{% block title %}Mis reservas{% endblock %}
{% block content %}
<h1>Mis reservas</h1>
<p><a class="btn btn-primary" href="{% url 'core:reservation_create' %}">Nueva reserva</a></p>

<table class="table">
  <thead>
    <tr>
      <th>Recurso</th>
      <th>Vecino</th>
      <th>Título</th>
      <th>Inicio</th>
      <th>Término</th>
      <th>Estado</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  {% for r in reservas %}
    <tr>
      <td>{{ r.resource }}</td>
      <td>{{ r.requested_by }}</td>
      <td>{{ r.title }}</td>
      <td>{{ r.start_at|date:"d-m-Y H:i" }}</td>
      <td>{{ r.end_at|date:"d-m-Y H:i" }}</td>
      <td>{{ r.get_status_display }}</td>
      <td>
        {# Solo puede cancelar quien creó la reserva y si está pendiente/aprobada #}
        {% if r.requested_by_id == user.id %}
          {% if r.status == "PENDING" or r.status == "APPROVED" %}
            <form method="post" action="{% url 'core:reservation_cancel' r.pk %}">
              {% csrf_token %}
              <button class="btn btn-small" type="submit">Cancelar</button>
            </form>
          {% endif %}
        {% endif %}
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="7" class="muted">No tienes reservas.</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
