{% extends "base.html" %}

{% block title %}Presidencia{% endblock %}

{% block content %}
<div class="container">
  <h1>Gestión de vecinos</h1>
  <p>Desde aquí el Presidente puede ver y gestionar a todas las personas registradas en la Junta de Vecinos.</p>

  <form method="get" class="resident-filters mb-3">
    <input
      type="text"
      name="q"
      placeholder="Buscar por nombre o email"
      value="{{ q }}"
      class="resident-filter-input"
    >

    <div class="resident-filters-right">
      <select name="activo" class="resident-filter-select">
        <option value="">Activo (todos)</option>
        <option value="si" {% if activo == "si" %}selected{% endif %}>Solo activos</option>
        <option value="no" {% if activo == "no" %}selected{% endif %}>Solo desactivados</option>
      </select>

      <button type="submit" class="resident-filter-btn">
        Filtrar
      </button>

      {% if q or activo %}
        <a href="{% url 'core:president_residents' %}"
           class="resident-filter-clear">
          Limpiar
        </a>
      {% endif %}
    </div>
  </form>


  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Rol en la junta</th>
        <th>Email</th>
        <th>Dirección</th>
        <th>Activo</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      {% for v in vecinos %}
        <tr>
          <td>{{ v.nombre }}</td>

          <td>
            {# Mostramos todos los grupos del usuario (Presidente, Tesorero, etc.) #}
            {% if v.user %}
              {% for g in v.user.groups.all %}
                {{ g.name }}{% if not forloop.last %}, {% endif %}
              {% empty %}
                Vecino
              {% endfor %}
            {% else %}
              Vecino
            {% endif %}
          </td>

          <td>
            {% if v.email %}
              {{ v.email }}
            {% elif v.user and v.user.email %}
              {{ v.user.email }}
            {% else %}
              —
            {% endif %}
          </td>

          <td>
            {% if v.direccion %}
              {{ v.direccion }}
            {% else %}
              —
            {% endif %}
          </td>

          <td>
            {% if v.activo %}Sí{% else %}No{% endif %}
          </td>

          <td class="resident-actions-cell">
            <a href="{% url 'core:resident_manage' v.pk %}"
              class="resident-action-btn w-100 text-center">
              Gestionar
            </a>
          </td>

        </tr>
      {% empty %}
        <tr>
          <td colspan="6">No hay vecinos registrados.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
