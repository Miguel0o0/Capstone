{% extends "base.html" %}

{% block title %}Presidencia{% endblock %}

{% block content %}
<div class="container">
  <h1>Gestión de vecinos</h1>
  <p>Desde aquí el Presidente puede ver y gestionar a todas las personas registradas en la Junta de Vecinos.</p>

  <form method="get" class="mb-3 d-flex gap-2 align-items-end">
    <input
      type="text"
      name="q"
      placeholder="Buscar por nombre o email"
      value="{{ q }}"
      style="min-width: 260px;"
    >
    <select name="activo">
      <option value="">Activo (todos)</option>
      <option value="si" {% if activo == "si" %}selected{% endif %}>Solo activos</option>
      <option value="no" {% if activo == "no" %}selected{% endif %}>Solo desactivados</option>
    </select>
    <button type="submit">Filtrar</button>
    {% if q or activo %}
      <a href="{% url 'core:president_residents' %}" style="margin-left:.5rem;">Limpiar</a>
    {% endif %}
  </form>

  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Rol en la junta</th>
        <th>Email</th>
        <th>Dirección</th>
        <th>Activo</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      {% for v in vecinos %}
        <tr>
          <td>{{ v.nombre }}</td>

          <td>
            {# Mostramos todos los grupos del usuario (Presidente, Tesorero, etc.) #}
            {% if v.user %}
              {% for g in v.user.groups.all %}
                {{ g.name }}{% if not forloop.last %}, {% endif %}
              {% empty %}
                Vecino
              {% endfor %}
            {% else %}
              Vecino
            {% endif %}
          </td>

          <td>
            {% if v.email %}
              {{ v.email }}
            {% elif v.user and v.user.email %}
              {{ v.user.email }}
            {% else %}
              —
            {% endif %}
          </td>

          <td>
            {% if v.direccion %}
              {{ v.direccion }}
            {% else %}
              —
            {% endif %}
          </td>

          <td>
            {% if v.activo %}Sí{% else %}No{% endif %}
          </td>

          <td>
            <form method="post" action="{% url 'core:resident_toggle' v.pk %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-primary">
                {% if v.activo %}Dar de baja{% else %}Reactivar{% endif %}
              </button>
            </form>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="6">No hay vecinos registrados.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
