{% extends "base.html" %}
{% load static %}

{% block content %}
<h1>Gestión de vecinos</h1>

{# Mensajes flash #}
{% if messages %}
  <div class="messages" style="margin:.5rem 0;">
    {% for m in messages %}
      <div class="msg {{ m.tags }}" style="padding:.4rem .6rem; border:1px solid #cfe3ff; background:#f3f8ff; margin-bottom:.3rem;">
        {{ m }}
      </div>
    {% endfor %}
  </div>
{% endif %}

{# Filtros #}
<form method="get" class="filters" style="display:flex; gap:.5rem; align-items:center; margin:.5rem 0 1rem;">
  <input
    type="text"
    name="q"
    value="{{ q }}"
    placeholder="Buscar por nombre o email"
    style="min-width:260px;"
  />

  <select name="activo">
    <option value="" {% if not activo %}selected{% endif %}>Activo (todos)</option>
    <option value="si" {% if activo == 'si' %}selected{% endif %}>Solo activos</option>
    <option value="no" {% if activo == 'no' %}selected{% endif %}>Solo inactivos</option>
  </select>

  <button type="submit">Filtrar</button>
  <a href="{% url 'core:president_residents' %}">Limpiar</a>
</form>

{# Tabla #}
<table class="table">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Email</th>
      <th>Activo</th>
      <th style="width:140px;">Acción</th>
    </tr>
  </thead>
  <tbody>
    {% for r in vecinos %}
      <tr>
        <td>{{ r.nombre }}</td>
        <td>{{ r.email|default:"-" }}</td>
        <td>{{ r.activo|yesno:"Sí,No" }}</td>
        <td>
          <form
            action="{% url 'core:resident_toggle' r.pk %}"
            method="post"
            style="display:inline-block"
          >
            {% csrf_token %}
            {% if r.activo %}
              <button type="submit">Desactivar</button>
            {% else %}
              <button type="submit">Activar</button>
            {% endif %}
          </form>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="4">No hay vecinos registrados.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{# Paginación preservando filtros #}
{% if is_paginated %}
  <nav class="pagination" style="margin-top:1rem; display:flex; gap:.5rem; align-items:center;">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}&q={{ q }}&activo={{ activo }}">« Anterior</a>
    {% endif %}

    <span>Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&q={{ q }}&activo={{ activo }}">Siguiente »</a>
    {% endif %}
  </nav>
{% endif %}
{% endblock %}
