{% extends "base.html" %}
{% load auth_extras %}
{% load l10n %}

{% block title %}Mis pagos{% endblock %}

{% block content %}
<div style="max-width:960px;margin:2.5rem auto 0;">
  <h1 style="text-align:center;margin-bottom:.25rem;">
    {% if user|has_group:"Delegado" %}
      Pagos
    {% else %}
      Mis pagos
    {% endif %}
  </h1>

  <p style="text-align:center;color:#6b7280;font-size:.9rem;margin-bottom:2rem;">
    Cuando tengas un pago pendiente, verás aquí el detalle y podrás subir el comprobante de transferencia
    para que el tesorero lo revise.
  </p>

  {% if payments %}
    {% for p in payments %}
      <article class="card" style="max-width:820px;margin:0 auto 1.5rem;">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:2rem;padding:1.5rem 2rem;">

          <!-- Lado izquierdo: detalle -->
          <div>
            <p style="margin:0 0 .25rem;font-weight:600;">
              {% if p.origin == "reservation" and p.reservation %}
                Reserva de {{ p.reservation.resource.nombre }}
              {% elif p.origin == "fee" and p.fee %}
                Cuota {{ p.fee.period }}
              {% else %}
                Pago
              {% endif %}
            </p>

            <p style="margin:0 0 .35rem;font-size:.85rem;color:#6b7280;">
              {% if p.origin == "reservation" and p.reservation %}
                {{ p.reservation.start_at|date:"d/m/Y H:i" }}
              {% endif %}
            </p>

            <p style="margin:0;font-size:.85rem;">
              Estado:
              <span style="
                display:inline-block;
                padding:.1rem .6rem;
                border-radius:999px;
                font-size:.8rem;
                background:#f97316;
                color:#fff;
              ">
                {{ p.get_status_display }}
              </span>
            </p>
          </div>

          <!-- Lado derecho: monto + acción -->
          <div style="text-align:right;min-width:160px;">
            <p style="margin:0 0 .5rem;font-weight:700;font-size:1.1rem;">
              ${{ p.amount|floatformat:0|localize }}
            </p>

            {% if p.status == "pending" %}
              {% if p.receipt_file %}
                <p style="margin:0 0 .5rem;font-size:.8rem;color:#6b7280;">
                  Comprobante subido {{ p.receipt_uploaded_at|date:"d/m/Y H:i" }}
                </p>
                <a href="{{ p.receipt_file.url }}"
                   target="_blank" rel="noopener"
                   class="btn btn-sm btn-outline">
                  Ver comprobante
                </a>
              {% else %}
                <a href="{% url 'core:payment_receipt_upload' p.pk %}"
                   class="btn btn-primary btn-sm">
                  Subir comprobante
                </a>
              {% endif %}
            {% endif %}
          </div>

        </div>
      </article>
    {% endfor %}
  {% else %}
    <p style="text-align:center;color:#9ca3af;">No tienes pagos aún.</p>
  {% endif %}
</div>
{% endblock %}
