{% extends "base.html" %}
{% load l10n %}

{% block title %}Subir comprobante{% endblock %}

{% block content %}
<div class="card" style="max-width: 520px; margin: 2rem auto;">
  <h1>Subir comprobante de pago</h1>

  <p style="color:#6b7280; font-size:.9rem; margin-bottom:1rem;">
    Reserva: {{ object.reservation.resource.nombre }}
    ({{ object.reservation.start_at|date:"d/m/Y H:i" }})<br>
    Monto: ${{ object.amount|floatformat:0|localize }} — Estado: {{ object.get_status_display }}<br>
    Destinatario: Patricio Soto<br>
    Rut: 11.111.111-1
  </p>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {{ form.non_field_errors }}

    <div style="margin-bottom:1rem;">
      <label for="{{ form.receipt_file.id_for_label }}"
             style="display:block; font-weight:600; margin-bottom:.25rem;">
        Comprobante de transferencia
      </label>

      {# --- Botón personalizado para seleccionar archivo --- #}
      <div class="file-upload-wrapper">
        <input
          type="file"
          name="{{ form.receipt_file.name }}"
          id="{{ form.receipt_file.id_for_label }}"
          accept=".pdf,.jpg,.jpeg,.png"
          required
          class="file-upload-input"
        >
        <button type="button"
                class="btn btn-outline file-upload-button"
                onclick="document.getElementById('{{ form.receipt_file.id_for_label }}').click();">
          Seleccionar archivo
        </button>
        <span id="file-upload-filename" class="file-upload-filename">
          Ningún archivo seleccionado
        </span>
      </div>

      {% if form.receipt_file.errors %}
        <div style="color:#b91c1c; font-size:.85rem; margin-top:.25rem;">
          {{ form.receipt_file.errors }}
        </div>
      {% endif %}

      {% if form.receipt_file.help_text %}
        <p style="color:#6b7280; font-size:.8rem; margin-top:.25rem;">
          {{ form.receipt_file.help_text }}
        </p>
      {% else %}
        <p style="color:#6b7280; font-size:.8rem; margin-top:.25rem;">
          Sube el comprobante en formato PDF, JPG o PNG.
        </p>
      {% endif %}
    </div>

    <div style="display:flex; gap:.5rem; margin-top:1rem;">
      <button type="submit" class="btn btn-primary">
        Subir comprobante
      </button>
      <a href="{% url 'core:my_payments' %}" class="btn btn-outline">
        Cancelar
      </a>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_body %}
<style>
  .file-upload-wrapper {
    display: flex;
    align-items: center;
    gap: .75rem;
    flex-wrap: wrap;
  }

  /* Input real oculto */
  .file-upload-input {
    display: none;
  }

  /* Botón “Seleccionar archivo” usando tus estilos base */
  .file-upload-button {
    cursor: pointer;
    min-width: 150px;
  }

  /* Texto con el nombre del archivo */
  .file-upload-filename {
    font-size: .85rem;
    color: #6b7280;
  }
</style>

<script>
  (function () {
    var input = document.getElementById("{{ form.receipt_file.id_for_label }}");
    var nameSpan = document.getElementById("file-upload-filename");
    if (!input || !nameSpan) return;

    input.addEventListener("change", function () {
      if (input.files && input.files.length > 0) {
        nameSpan.textContent = input.files[0].name;
      } else {
        nameSpan.textContent = "Ningún archivo seleccionado";
      }
    });
  })();
</script>
{% endblock %}
