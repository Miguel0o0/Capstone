{% load static %}
{% load auth_extras %}

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Junta UT{% endblock %}</title>

  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/components.css' %}">
  <link rel="stylesheet" href="{% static 'css/utilities.css' %}">
  {% block extra_head %}{% endblock %}
</head>
<body>

  <header class="site-header">
    <nav class="navbar container">
      <a class="brand" href="{% url 'core:home' %}">
        <img src="{% static 'img/logo.png' %}" alt="Logo Junta UT">
        <span>Junta UT</span>
      </a>

      <ul class="nav-links">
        {% if request.user.is_authenticated %}
          {# Ítems dinámicos construidos en build_nav_items(request) #}
          {% for item in nav_items %}
            <li><a href="{{ item.url }}">{{ item.label }}</a></li>
          {% empty %}
            <li><span style="color:#888;">Sin opciones</span></li>
          {% endfor %}

          {# Acceso directo a Inscripciones para management #}
          {% if perms.core.view_inscriptionevidence %}
            <li><a href="{% url 'core:insc_admin' %}">Inscripciones</a></li>
          {% endif %}
        {% else %}
          {# CTA público para nuevos vecinos #}
          <li><a href="{% url 'core:insc_create' %}">Quiero unirme</a></li>
        {% endif %}
      </ul>

      <div class="nav-actions">
        {% if request.user.is_authenticated %}
          <form action="{% url 'logout' %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline">Cerrar sesión</button>
          </form>
        {% else %}
          <a class="btn btn-primary" href="{% url 'login' %}">Iniciar sesión</a>
        {% endif %}
      </div>
    </nav>

    {# Mensajes flash #}
    {% if messages %}
      <div class="messages" style="margin:.5rem 1rem;">
        {% for m in messages %}
          <div class="msg {{ m.tags }}" style="padding:.4rem .6rem; border:1px solid #cfe3ff; background:#f3f8ff; margin-bottom:.3rem;">
            {{ m }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </header>

  <main class="site-content container">
    {% block content %}{% endblock %}
  </main>

  <footer class="site-footer">
    <p>© {% now "Y" %} Junta de Vecinos UT</p>
  </footer>

  {% block extra_body %}{% endblock %}
</body>
</html>
